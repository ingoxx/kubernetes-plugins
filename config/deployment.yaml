apiVersion: apps/v1
kind: Deployment
metadata:
  name: custom-filter-scheduler-deployment
  namespace: web
  labels:
    app: custom-filter-scheduler
spec:
  replicas: 2 # ç”Ÿäº§ç¯å¢ƒæ¨èè‡³å°‘ 2 ä¸ªå‰¯æœ¬å’Œ Leader Election
  selector:
    matchLabels:
      app: custom-filter-scheduler
  template:
    metadata:
      labels:
        app: custom-filter-scheduler
    spec:
      serviceAccountName: custom-scheduler-sa
      containers:
      - name: custom-scheduler-container
        image: gotec007/kubernetes-scheduler-plugins:v2 # ğŸ‘ˆ æ›¿æ¢ä¸ºæ‚¨çš„é•œåƒè·¯å¾„
        imagePullPolicy: Always
        command:
        # command: æŒ‡å®šè¦æ‰§è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ï¼ˆä»£æ›¿ ENTRYPOINTï¼‰
        - /usr/local/bin/custom-scheduler 
        args:
        # args: æŒ‡å®šä¼ é€’ç»™è¯¥å¯æ‰§è¡Œæ–‡ä»¶çš„å‚æ•°
        - --config=/etc/kubernetes/scheduler-config.yaml
Â  Â      - --leader-elect=true
        - --leader-elect-resource-namespace=web # ä½¿ç”¨æ‚¨çš„å‘½åç©ºé—´
        - --leader-elect-resource-name=custom-scheduler-lease # ğŸ‘ˆ ç¡®ä¿åç§°å”¯ä¸€
        # æŒ‚è½½ ConfigMap ä½œä¸ºé…ç½®æ–‡ä»¶
        volumeMounts:
        - name: scheduler-config-volume
          mountPath: /etc/kubernetes/scheduler-config.yaml
          subPath: scheduler-config.yaml
      volumes:
      - name: scheduler-config-volume
        configMap:
          name: custom-scheduler-config-cm
